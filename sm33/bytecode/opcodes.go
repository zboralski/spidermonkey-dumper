package bytecode

// JOF_* constants define opcode operand format types
const (
	JOF_BYTE       = 0
	JOF_JUMP       = 1
	JOF_ATOM       = 2
	JOF_UINT16     = 3
	JOF_TABLESWITCH = 4
	JOF_QARG       = 6
	JOF_LOCAL      = 7
	JOF_DOUBLE     = 8
	JOF_UINT24     = 12
	JOF_UINT8      = 13
	JOF_INT32      = 14
	JOF_OBJECT     = 15
	JOF_REGEXP     = 17
	JOF_INT8       = 18
	JOF_ATOMOBJECT = 19
	JOF_SCOPECOORD = 21
	JOF_TYPEMASK   = 0x001f
)

// OpInfo holds metadata about a bytecode operation
type OpInfo struct {
	Name   string
	Length int8
	Format uint32
}

// JofType extracts the operand type from a format value
func JofType(format uint32) uint32 {
	return format & JOF_TYPEMASK
}

// Opcodes is the SpiderMonkey 33.1.1 opcode table
var Opcodes = [256]OpInfo{
	0:   {"nop", 1, JOF_BYTE},
	1:   {"undefined", 1, JOF_BYTE},
	2:   {"unused2", 1, JOF_BYTE},
	3:   {"enterwith", 5, JOF_OBJECT},
	4:   {"leavewith", 1, JOF_BYTE},
	5:   {"return", 1, JOF_BYTE},
	6:   {"goto", 5, JOF_JUMP},
	7:   {"ifeq", 5, JOF_JUMP},
	8:   {"ifne", 5, JOF_JUMP},
	9:   {"arguments", 1, JOF_BYTE},
	10:  {"swap", 1, JOF_BYTE},
	11:  {"popn", 3, JOF_UINT16},
	12:  {"dup", 1, JOF_BYTE},
	13:  {"dup2", 1, JOF_BYTE},
	14:  {"setconst", 5, JOF_ATOM},
	15:  {"bitor", 1, JOF_BYTE},
	16:  {"bitxor", 1, JOF_BYTE},
	17:  {"bitand", 1, JOF_BYTE},
	18:  {"eq", 1, JOF_BYTE},
	19:  {"ne", 1, JOF_BYTE},
	20:  {"lt", 1, JOF_BYTE},
	21:  {"le", 1, JOF_BYTE},
	22:  {"gt", 1, JOF_BYTE},
	23:  {"ge", 1, JOF_BYTE},
	24:  {"lsh", 1, JOF_BYTE},
	25:  {"rsh", 1, JOF_BYTE},
	26:  {"ursh", 1, JOF_BYTE},
	27:  {"add", 1, JOF_BYTE},
	28:  {"sub", 1, JOF_BYTE},
	29:  {"mul", 1, JOF_BYTE},
	30:  {"div", 1, JOF_BYTE},
	31:  {"mod", 1, JOF_BYTE},
	32:  {"not", 1, JOF_BYTE},
	33:  {"bitnot", 1, JOF_BYTE},
	34:  {"neg", 1, JOF_BYTE},
	35:  {"pos", 1, JOF_BYTE},
	36:  {"delname", 5, JOF_ATOM},
	37:  {"delprop", 5, JOF_ATOM},
	38:  {"delelem", 1, JOF_BYTE},
	39:  {"typeof", 1, JOF_BYTE},
	40:  {"void", 1, JOF_BYTE},
	41:  {"spreadcall", 1, JOF_BYTE},
	42:  {"spreadnew", 1, JOF_BYTE},
	43:  {"spreadeval", 1, JOF_BYTE},
	44:  {"dupat", 4, JOF_UINT24},
	45:  {"unused45", 1, JOF_BYTE},
	46:  {"unused46", 1, JOF_BYTE},
	47:  {"unused47", 1, JOF_BYTE},
	48:  {"unused48", 1, JOF_BYTE},
	49:  {"unused49", 1, JOF_BYTE},
	50:  {"unused50", 1, JOF_BYTE},
	51:  {"unused51", 1, JOF_BYTE},
	52:  {"unused52", 1, JOF_BYTE},
	53:  {"getprop", 5, JOF_ATOM},
	54:  {"setprop", 5, JOF_ATOM},
	55:  {"getelem", 1, JOF_BYTE},
	56:  {"setelem", 1, JOF_BYTE},
	57:  {"unused57", 1, JOF_BYTE},
	58:  {"call", 3, JOF_UINT16},
	59:  {"name", 5, JOF_ATOM},
	60:  {"double", 5, JOF_DOUBLE},
	61:  {"string", 5, JOF_ATOM},
	62:  {"zero", 1, JOF_BYTE},
	63:  {"one", 1, JOF_BYTE},
	64:  {"null", 1, JOF_BYTE},
	65:  {"this", 1, JOF_BYTE},
	66:  {"false", 1, JOF_BYTE},
	67:  {"true", 1, JOF_BYTE},
	68:  {"or", 5, JOF_JUMP},
	69:  {"and", 5, JOF_JUMP},
	70:  {"tableswitch", -1, JOF_TABLESWITCH},
	71:  {"runonce", 1, JOF_BYTE},
	72:  {"stricteq", 1, JOF_BYTE},
	73:  {"strictne", 1, JOF_BYTE},
	74:  {"setcall", 1, JOF_BYTE},
	75:  {"iter", 2, JOF_UINT8},
	76:  {"moreiter", 1, JOF_BYTE},
	77:  {"iternext", 1, JOF_BYTE},
	78:  {"enditer", 1, JOF_BYTE},
	79:  {"funapply", 3, JOF_UINT16},
	80:  {"object", 5, JOF_OBJECT},
	81:  {"pop", 1, JOF_BYTE},
	82:  {"new", 3, JOF_UINT16},
	83:  {"unused83", 1, JOF_BYTE},
	84:  {"getarg", 3, JOF_QARG},
	85:  {"setarg", 3, JOF_QARG},
	86:  {"getlocal", 4, JOF_LOCAL},
	87:  {"setlocal", 4, JOF_LOCAL},
	88:  {"uint16", 3, JOF_UINT16},
	89:  {"newinit", 5, JOF_UINT8},
	90:  {"newarray", 4, JOF_UINT24},
	91:  {"newobject", 5, JOF_OBJECT},
	92:  {"endinit", 1, JOF_BYTE},
	93:  {"initprop", 5, JOF_ATOM},
	94:  {"initelem", 1, JOF_BYTE},
	95:  {"initelem_inc", 1, JOF_BYTE},
	96:  {"initelem_array", 4, JOF_UINT24},
	97:  {"initprop_getter", 5, JOF_ATOM},
	98:  {"initprop_setter", 5, JOF_ATOM},
	99:  {"initelem_getter", 1, JOF_BYTE},
	100: {"initelem_setter", 1, JOF_BYTE},
	101: {"unused101", 1, JOF_BYTE},
	102: {"unused102", 1, JOF_BYTE},
	103: {"unused103", 1, JOF_BYTE},
	104: {"unused104", 1, JOF_BYTE},
	105: {"unused105", 1, JOF_BYTE},
	106: {"label", 5, JOF_JUMP},
	107: {"unused107", 1, JOF_BYTE},
	108: {"funcall", 3, JOF_UINT16},
	109: {"loophead", 1, JOF_BYTE},
	110: {"bindname", 5, JOF_ATOM},
	111: {"setname", 5, JOF_ATOM},
	112: {"throw", 1, JOF_BYTE},
	113: {"in", 1, JOF_BYTE},
	114: {"instanceof", 1, JOF_BYTE},
	115: {"debugger", 1, JOF_BYTE},
	116: {"gosub", 5, JOF_JUMP},
	117: {"retsub", 1, JOF_BYTE},
	118: {"exception", 1, JOF_BYTE},
	119: {"lineno", 3, JOF_UINT16},
	120: {"condswitch", 1, JOF_BYTE},
	121: {"case", 5, JOF_JUMP},
	122: {"default", 5, JOF_JUMP},
	123: {"eval", 3, JOF_UINT16},
	124: {"unused124", 1, JOF_BYTE},
	125: {"unused125", 1, JOF_BYTE},
	126: {"unused126", 1, JOF_BYTE},
	127: {"deffun", 5, JOF_OBJECT},
	128: {"defconst", 5, JOF_ATOM},
	129: {"defvar", 5, JOF_ATOM},
	130: {"lambda", 5, JOF_OBJECT},
	131: {"lambda_arrow", 5, JOF_OBJECT},
	132: {"callee", 1, JOF_BYTE},
	133: {"pick", 2, JOF_UINT8},
	134: {"try", 1, JOF_BYTE},
	135: {"finally", 1, JOF_BYTE},
	136: {"getaliasedvar", 5, JOF_SCOPECOORD},
	137: {"setaliasedvar", 5, JOF_SCOPECOORD},
	138: {"unused138", 1, JOF_BYTE},
	139: {"unused139", 1, JOF_BYTE},
	140: {"unused140", 1, JOF_BYTE},
	141: {"unused141", 1, JOF_BYTE},
	142: {"unused142", 1, JOF_BYTE},
	143: {"getintrinsic", 5, JOF_ATOM},
	144: {"setintrinsic", 5, JOF_ATOM},
	145: {"bindintrinsic", 5, JOF_ATOM},
	146: {"unused146", 1, JOF_BYTE},
	147: {"unused147", 1, JOF_BYTE},
	148: {"unused148", 1, JOF_BYTE},
	149: {"backpatch", 5, JOF_JUMP},
	150: {"unused150", 1, JOF_BYTE},
	151: {"throwing", 1, JOF_BYTE},
	152: {"setrval", 1, JOF_BYTE},
	153: {"retrval", 1, JOF_BYTE},
	154: {"getgname", 5, JOF_ATOM},
	155: {"setgname", 5, JOF_ATOM},
	156: {"unused156", 1, JOF_BYTE},
	157: {"unused157", 1, JOF_BYTE},
	158: {"unused158", 1, JOF_BYTE},
	159: {"unused159", 1, JOF_BYTE},
	160: {"regexp", 5, JOF_REGEXP},
	161: {"unused161", 1, JOF_BYTE},
	162: {"unused162", 1, JOF_BYTE},
	163: {"unused163", 1, JOF_BYTE},
	164: {"unused164", 1, JOF_BYTE},
	165: {"unused165", 1, JOF_BYTE},
	166: {"unused166", 1, JOF_BYTE},
	167: {"unused167", 1, JOF_BYTE},
	168: {"unused168", 1, JOF_BYTE},
	169: {"unused169", 1, JOF_BYTE},
	170: {"unused170", 1, JOF_BYTE},
	171: {"unused171", 1, JOF_BYTE},
	172: {"unused172", 1, JOF_BYTE},
	173: {"unused173", 1, JOF_BYTE},
	174: {"unused174", 1, JOF_BYTE},
	175: {"unused175", 1, JOF_BYTE},
	176: {"unused176", 1, JOF_BYTE},
	177: {"unused177", 1, JOF_BYTE},
	178: {"unused178", 1, JOF_BYTE},
	179: {"unused179", 1, JOF_BYTE},
	180: {"unused180", 1, JOF_BYTE},
	181: {"unused181", 1, JOF_BYTE},
	182: {"unused182", 1, JOF_BYTE},
	183: {"unused183", 1, JOF_BYTE},
	184: {"callprop", 5, JOF_ATOM},
	185: {"unused185", 1, JOF_BYTE},
	186: {"unused186", 1, JOF_BYTE},
	187: {"unused187", 1, JOF_BYTE},
	188: {"uint24", 4, JOF_UINT24},
	189: {"unused189", 1, JOF_BYTE},
	190: {"unused190", 1, JOF_BYTE},
	191: {"unused191", 1, JOF_BYTE},
	192: {"unused192", 1, JOF_BYTE},
	193: {"callelem", 1, JOF_BYTE},
	194: {"mutateproto", 1, JOF_BYTE},
	195: {"getxprop", 5, JOF_ATOM},
	196: {"unused196", 1, JOF_BYTE},
	197: {"typeofexpr", 1, JOF_BYTE},
	198: {"pushblockscope", 5, JOF_OBJECT},
	199: {"popblockscope", 1, JOF_BYTE},
	200: {"debugleaveblock", 1, JOF_BYTE},
	201: {"unused201", 1, JOF_BYTE},
	202: {"generator", 1, JOF_BYTE},
	203: {"yield", 1, JOF_BYTE},
	204: {"arraypush", 1, JOF_BYTE},
	205: {"unused205", 1, JOF_BYTE},
	206: {"unused206", 1, JOF_BYTE},
	207: {"unused207", 1, JOF_BYTE},
	208: {"unused208", 1, JOF_BYTE},
	209: {"unused209", 1, JOF_BYTE},
	210: {"unused210", 1, JOF_BYTE},
	211: {"unused211", 1, JOF_BYTE},
	212: {"unused212", 1, JOF_BYTE},
	213: {"unused213", 1, JOF_BYTE},
	214: {"bindgname", 5, JOF_ATOM},
	215: {"int8", 2, JOF_INT8},
	216: {"int32", 5, JOF_INT32},
	217: {"length", 5, JOF_ATOM},
	218: {"hole", 1, JOF_BYTE},
	219: {"unused219", 1, JOF_BYTE},
	220: {"unused220", 1, JOF_BYTE},
	221: {"unused221", 1, JOF_BYTE},
	222: {"unused222", 1, JOF_BYTE},
	223: {"unused223", 1, JOF_BYTE},
	224: {"rest", 1, JOF_BYTE},
	225: {"toid", 1, JOF_BYTE},
	226: {"implicitthis", 5, JOF_ATOM},
	227: {"loopentry", 2, JOF_UINT8},
	228: {"tostring", 1, JOF_BYTE},
	// 229-255 remain zero-valued
}
